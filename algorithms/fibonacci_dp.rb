# Single line Fibonacci number generator with memoization

require 'benchmark'
require 'objspace'

fibonacci = Hash.new { |hash, key| hash[key] = key < 2 ? key : hash[key - 1] + hash[key - 2] }

times = []
memsizes = []
(0..150000).step(3500) do |n|
  times << Benchmark.realtime { fibonacci[n] }
  memsizes << ObjectSpace.memsize_of(fibonacci)
end
times # => [7.0e-06, 0.013753, 0.006775, 0.011028, 0.011766, 0.013663, 0.016898, 0.020432, 0.020921, 0.022658, 0.031865, 0.028004, 0.030102, 0.0301, 0.035553, 0.038628, 0.040595, 0.050672, 0.042334, 0.061175, 0.051478, 0.057278, 0.053692, 0.071981, 0.069843, 0.073607, 0.069373, 0.065416, 0.085222, 0.079286, 0.087959, 0.09263, 0.097695, 0.12316, 0.106536, 0.102009, 0.11468, 0.114278, 0.114079, 0.113236, 0.124698, 0.129963, 0.132015]
memsizes # => [192, 176360, 352520, 536888, 704888, 872888, 1073848, 1241848, 1409848, 1577848, 1745848, 1913848, 2147512, 2315512, 2483512, 2651512, 2819512, 2987512, 3155512, 3323512, 3491512, 3659512, 3827512, 3995512, 4294264, 4462264, 4630264, 4798264, 4966264, 5134264, 5302264, 5470264, 5638264, 5806264, 5974264, 6142264, 6310264, 6478264, 6646264, 6814264, 6982264, 7150264, 7318264]

fibonacci.count # => 147001

graph = times.map { |time| '-' * (time * 1000).to_i }
graph.each { |bar| puts bar }
# >> 
# >> -------------
# >> ------
# >> -----------
# >> -----------
# >> -------------
# >> ----------------
# >> --------------------
# >> --------------------
# >> ----------------------
# >> -------------------------------
# >> ----------------------------
# >> ------------------------------
# >> ------------------------------
# >> -----------------------------------
# >> --------------------------------------
# >> ----------------------------------------
# >> --------------------------------------------------
# >> ------------------------------------------
# >> -------------------------------------------------------------
# >> ---------------------------------------------------
# >> ---------------------------------------------------------
# >> -----------------------------------------------------
# >> -----------------------------------------------------------------------
# >> ---------------------------------------------------------------------
# >> -------------------------------------------------------------------------
# >> ---------------------------------------------------------------------
# >> -----------------------------------------------------------------
# >> -------------------------------------------------------------------------------------
# >> -------------------------------------------------------------------------------
# >> ---------------------------------------------------------------------------------------
# >> --------------------------------------------------------------------------------------------
# >> -------------------------------------------------------------------------------------------------
# >> ---------------------------------------------------------------------------------------------------------------------------
# >> ----------------------------------------------------------------------------------------------------------
# >> ------------------------------------------------------------------------------------------------------
# >> ------------------------------------------------------------------------------------------------------------------
# >> ------------------------------------------------------------------------------------------------------------------
# >> ------------------------------------------------------------------------------------------------------------------
# >> -----------------------------------------------------------------------------------------------------------------
# >> ----------------------------------------------------------------------------------------------------------------------------
# >> ---------------------------------------------------------------------------------------------------------------------------------
# >> ------------------------------------------------------------------------------------------------------------------------------------
